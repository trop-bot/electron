'use strict'

const { EventEmitter } = require('events')
<<<<<<< HEAD
const binding = process.atomBinding('web_frame')
=======
const { webFrame, WebFrame } = process.atomBinding('web_frame')
const { deprecate } = require('electron')
>>>>>>> chore: Add new webFrame IsolatedWorldInfo API and deprecate

class WebFrame extends EventEmitter {
  constructor (context) {
    super()

<<<<<<< HEAD
    this.context = context
    // Lots of webview would subscribe to webFrame's events.
    this.setMaxListeners(0)
  }
=======
// Lots of webview would subscribe to webFrame's events.
webFrame.setMaxListeners(0)
webFrame.setIsolatedWorldSecurityOrigin = (worldId, securityOrigin) => {
  deprecate.warn('webFrame.setIsolatedWorldSecurityOrigin', 'webFrame.setIsolatedWorldInfo')
  webFrame._setIsolatedWorldSecurityOrigin(worldId, securityOrigin)
}

webFrame.setIsolatedWorldContentSecurityPolicy = (worldId, csp) => {
  deprecate.warn('webFrame.setIsolatedWorldContentSecurityPolicy', 'webFrame.setIsolatedWorldInfo')
  webFrame._setIsolatedWorldContentSecurityPolicy(worldId, csp)
}

webFrame.setIsolatedWorldHumanReadableName = (worldId, name) => {
  deprecate.warn('webFrame.setIsolatedWorldHumanReadableName', 'webFrame.setIsolatedWorldInfo')
  webFrame._setIsolatedWorldHumanReadableName(worldId, name)
}
>>>>>>> chore: Add new webFrame IsolatedWorldInfo API and deprecate

  findFrameByRoutingId (...args) {
    return getWebFrame(binding._findFrameByRoutingId(this.context, ...args))
  }

  getFrameForSelector (...args) {
    return getWebFrame(binding._getFrameForSelector(this.context, ...args))
  }

  findFrameByName (...args) {
    return getWebFrame(binding._findFrameByName(this.context, ...args))
  }

  get opener () {
    return getWebFrame(binding._getOpener(this.context))
  }

  get parent () {
    return getWebFrame(binding._getParent(this.context))
  }

  get top () {
    return getWebFrame(binding._getTop(this.context))
  }

  get firstChild () {
    return getWebFrame(binding._getFirstChild(this.context))
  }

  get nextSibling () {
    return getWebFrame(binding._getNextSibling(this.context))
  }

  get routingId () {
    return binding._getRoutingId(this.context)
  }
}

// Populate the methods.
for (const name in binding) {
  if (!name.startsWith('_')) { // some methods are manully populated above
    WebFrame.prototype[name] = function (...args) {
      return binding[name](this.context, ...args)
    }
  }
}

// Helper to return WebFrame or null depending on context.
// TODO(zcbenz): Consider returning same WebFrame for the same frame.
function getWebFrame (context) {
  return context ? new WebFrame(context) : null
}

module.exports = new WebFrame(window)
